{"version":3,"sources":["webpack:///./src/views/ChangeEmail.vue?8e0f","webpack:///src/views/ChangeEmail.vue","webpack:///./src/views/ChangeEmail.vue?085f","webpack:///./src/views/ChangeEmail.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","attrs","slot","on","backToProfile","i","arrowBack","$event","preventDefault","onSubmit","_s","userDetails","email","setEmailLostFocus","email_not_focused","model","value","callback","$$v","expression","$v","_e","unique","$pending","passwordCorrect","userProvidedPassword","$invalid","tooManyAttempts","staticRenderFns","name","data","validations","required","computed","methods","console","log","newData","newEmail","$store","dispatch","$touch","$router","replace","created","userId","component"],"mappings":"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","file":"js/chunk-2d0bdf87.79689a0a.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"ion-page\"},[_c('ion-header',[_c('ion-toolbar',[_c('ion-title',[_vm._v(\"Change Email\")]),_c('ion-buttons',{attrs:{\"slot\":\"start\"},slot:\"start\"},[_c('ion-button',{on:{\"click\":_vm.backToProfile}},[_c('ion-icon',{attrs:{\"src\":_vm.i.arrowBack}})],1)],1)],1)],1),_c('ion-content',{staticClass:\"ion-padding\"},[_c('ion-grid',{attrs:{\"fixed\":\"\"}},[_c('ion-row',[_c('ion-col',{attrs:{\"size\":\"12\",\"offset-md\":\"3\",\"size-md\":\"6\",\"offset-xl\":\"4\",\"size-xl\":\"4\"}},[_c('form',{on:{\"submit\":function($event){$event.preventDefault();return _vm.onSubmit($event)}}},[_c('ion-item',{staticClass:\"ion-padding-bottom\",attrs:{\"lines\":\"none\"}},[_c('ion-label',{attrs:{\"position\":\"stacked\"}},[_vm._v(\"Current Email:\")]),_c('ion-text',[_c('b',[_vm._v(_vm._s(_vm.userDetails.email))])])],1),_c('ion-item',{staticClass:\"input\",attrs:{\"lines\":\"none\"}},[_c('ion-label',{attrs:{\"position\":\"stacked\",\"for\":\"email\"}},[_vm._v(\"New Email \"),_c('ion-text',{attrs:{\"color\":\"danger\"}},[_vm._v(\"*\")])],1),_c('ion-input-vue',{attrs:{\"type\":\"email\",\"id\":\"email\",\"inputmode\":\"email\",\"debounce\":\"300\"},on:{\"ionBlur\":_vm.setEmailLostFocus,\"ionFocus\":function($event){_vm.email_not_focused = false}},model:{value:(_vm.email),callback:function ($$v) {_vm.email=$$v},expression:\"email\"}}),(!_vm.$v.email.email && _vm.email_not_focused)?_c('ion-note',{staticClass:\"error ion-padding\",attrs:{\"color\":\"danger\"}},[_vm._v(\"Valid Email Required\")]):_vm._e(),(!_vm.$v.email.unique && !_vm.$v.email.$pending)?_c('ion-note',{staticClass:\"error ion-padding\",attrs:{\"color\":\"danger\"}},[_vm._v(\"Email Already Taken\")]):_vm._e()],1),_c('ion-item',{staticClass:\"ion-padding-bottom\",attrs:{\"lines\":\"none\"}},[_c('ion-label',{attrs:{\"position\":\"stacked\"}},[_vm._v(\"Current Password:\")]),_c('ion-input-vue',{attrs:{\"type\":\"password\",\"id\":\"userProvidedPassword\"},on:{\"ionFocus\":function($event){_vm.passwordCorrect = true}},model:{value:(_vm.userProvidedPassword),callback:function ($$v) {_vm.userProvidedPassword=$$v},expression:\"userProvidedPassword\"}}),(!_vm.passwordCorrect)?_c('ion-note',{staticClass:\"error ion-padding\",attrs:{\"color\":\"danger\"}},[_vm._v(\"Incorrect Password Entered\")]):_vm._e(),(_vm.tooManyAttempts)?_c('ion-note',{staticClass:\"error ion-padding\",attrs:{\"color\":\"danger\"}},[_vm._v(\"Too Many Attempts - 'Change Email' is temporarily disabled for this user - Please try again later\")]):_vm._e()],1),_c('div',{staticClass:\"ion-padding\"},[_c('ion-button',{attrs:{\"type\":\"submit\",\"disabled\":_vm.$v.$invalid || _vm.tooManyAttempts}},[_vm._v(\"Submit\")])],1)],1)])],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"ion-page\">\n    <ion-header>\n          <ion-toolbar>\n              <ion-title>Change Email</ion-title>\n              <ion-buttons slot=\"start\">\n                <ion-button @click=\"backToProfile\">\n                    <ion-icon :src=\"i.arrowBack\"></ion-icon>\n                </ion-button>\n              </ion-buttons>\n          </ion-toolbar>\n      </ion-header>\n    <ion-content class=\"ion-padding\">\n      <ion-grid fixed>\n        <ion-row>\n          <ion-col size=\"12\" offset-md=\"3\" size-md=\"6\" offset-xl=\"4\" size-xl=\"4\">\n            <form @submit.prevent=\"onSubmit\">\n              <ion-item lines=\"none\" class=\"ion-padding-bottom\">\n                  <ion-label position=\"stacked\">Current Email:</ion-label>\n                  <ion-text><b>{{ userDetails.email }}</b></ion-text>\n              </ion-item>\n              <ion-item lines=\"none\" class=\"input\">\n                <ion-label position=\"stacked\" for=\"email\">New Email <ion-text color=\"danger\">*</ion-text></ion-label>\n                <ion-input-vue\n                        type=\"email\" id=\"email\" inputmode=\"email\"\n                        debounce=\"300\" @ionBlur=\"setEmailLostFocus\"\n                        v-model=\"email\" @ionFocus=\"email_not_focused = false\"></ion-input-vue>\n                <ion-note v-if=\"!$v.email.email && email_not_focused\" class=\"error ion-padding\" color=\"danger\">Valid Email Required</ion-note>\n                <ion-note v-if=\"!$v.email.unique && !$v.email.$pending\" class=\"error ion-padding\" color=\"danger\">Email Already Taken</ion-note>\n              </ion-item>\n              <ion-item lines=\"none\" class=\"ion-padding-bottom\">\n                  <ion-label position=\"stacked\">Current Password:</ion-label>\n                  <ion-input-vue @ionFocus=\"passwordCorrect = true\" type=\"password\" id=\"userProvidedPassword\" v-model=\"userProvidedPassword\"></ion-input-vue>\n                  <ion-note v-if=\"!passwordCorrect\" class=\"error ion-padding\" color=\"danger\">Incorrect Password Entered</ion-note>\n                 <ion-note v-if=\"tooManyAttempts\" class=\"error ion-padding\" color=\"danger\">Too Many Attempts - 'Change Email' is temporarily disabled for this user - Please try again later</ion-note>\n              </ion-item>\n              <div class=\"ion-padding\">\n                <ion-button type=\"submit\" :disabled=\"$v.$invalid || tooManyAttempts\">Submit</ion-button>\n              </div>\n            </form>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </ion-content>\n  </div>\n</template>\n\n<script>\nimport { required, email } from 'vuelidate/lib/validators'\nimport axios from '@/axios-auth'\nimport * as allIcons from 'ionicons/icons'\nimport { mapGetters } from 'vuex'\nimport { toastController } from '@ionic/core'\n\nconst handleToast = (message, isError = false) => {\n  toastController\n    .create({\n      message: message,\n      position: 'top',\n      color: isError ? 'danger' : 'success',\n      duration: 2000\n    })\n    .then((t) => t.present())\n}\n\nexport default {\n  name: 'change-email',\n  data () {\n    return {\n      email: '',\n      userProvidedPassword: '',\n      email_not_focused: false,\n      passwordCorrect: true,\n      tooManyAttempts: false,\n      i: allIcons\n    }\n  },\n  validations: {\n    email: {\n      required,\n      email,\n      async unique (val) {\n        if (val.trim().length === 0) return true\n        let isUnique = true\n        const emailRegex = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\n\n        if (emailRegex.test(val)) {\n          console.log('is a valid email, checking if unique')\n\n          const response = await axios.post(':createAuthUri?key=AIzaSyB8-xAjyYMTR0Jt1-H-ayS9FDINW4JdAhQ', {\n            identifier: val,\n            continueUri: window.location.href\n          })\n            .catch((ex) => {\n              console.log('error:', ex)\n              return true\n            })\n\n          console.log('response:', response)\n          isUnique = !response.data.registered\n        }\n        return await Boolean(isUnique)\n      }\n    }\n  },\n  computed: {\n    ...mapGetters('userModule', [\n      'userDetails',\n      'userId'\n    ])\n  },\n  methods: {\n    onSubmit () {\n      this.passwordCorrect = true\n\n      const newData = { newEmail: this.email, userProvidedPassword: this.userProvidedPassword }\n      console.log('new email:', newData.newEmail)\n      this.$store.dispatch('userModule/changeEmail', newData)\n        .then(() => {\n          handleToast('Email Changed Successfully!', false)\n          this.userProvidedPassword = ''\n        })\n        .catch(error => {\n          if (error.code.toUpperCase().includes('WRONG-PASSWORD') || error.code.toUpperCase().includes('INVALID_PASSWORD')) {\n            this.passwordCorrect = false\n          } else if (error.code.toUpperCase().includes('TOO-MANY-REQUESTS')) {\n            this.tooManyAttempts = true\n          }\n          handleToast('Email not changed', true)\n        })\n    },\n    setEmailLostFocus () {\n      console.log('email lost focus')\n      this.$v.email.$touch(true)\n      this.email_not_focused = true\n    },\n    backToProfile () {\n      this.$router.replace({ name: 'profile' })\n    }\n  },\n  created () {\n    if (this.userDetails.email === '') {\n      this.$store.dispatch('userModule/fetchUserDetails', this.userId)\n    }\n  }\n}\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChangeEmail.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ChangeEmail.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ChangeEmail.vue?vue&type=template&id=04f5b289&\"\nimport script from \"./ChangeEmail.vue?vue&type=script&lang=js&\"\nexport * from \"./ChangeEmail.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}